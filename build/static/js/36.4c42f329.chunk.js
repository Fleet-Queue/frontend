"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[36],{5266:function(e,t,o){o.d(t,{h:function(){return l}});var n=o(6031),a=o.n(n);const l=(e,t,o)=>e.map((e=>a().mapKeys(e,((e,n)=>{for(let a=0;a<o.length;a++)if(n===t[a])return o[a];return n}))))},1036:function(e,t,o){o.r(t),o.d(t,{default:function(){return w}});var n=o(7313),a=o(7890),l=o(2832),r=o(8999),i=o(5266),c=o(6046),s=o(3208),d=o(5904),u=o(9536),m=o(9019),h=o(1387),v=o(1322),p=o(5713),f=o(8737),x=o(1095),g=o(5660),y=o(658),j=o.n(y),k=o(6417);const Z=["name","View DO","availableFrom","status","allocation"];function I(e){let{partyId:t,data:o,updateData:a,selectedDate:l,setSelectedDate:y}=e;const[I,b]=(0,n.useState)(!1),[D,C]=(0,n.useState)(),w=(0,i.h)(o,["truckType","link","availableFrom","status"],Z),_=()=>{a(t,l.format("DD/MM/YYYY"))};console.log(D);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(u.Z,{sx:{mb:2},children:(0,k.jsxs)(m.ZP,{container:!0,spacing:2,alignItems:"center",children:[(0,k.jsx)(m.ZP,{item:!0,xs:12,md:6,children:(0,k.jsx)(s._,{dateAdapter:d.y,children:(0,k.jsx)(c.M,{label:"Select Date",value:l,onChange:e=>y(e),slotProps:{textField:{size:"small",fullWidth:!0}}})})}),(0,k.jsx)(m.ZP,{item:!0,xs:12,md:6,children:(0,k.jsx)(x.Z,{variant:"contained",startIcon:(0,k.jsx)(g.Z,{}),onClick:()=>{const e=[];o.forEach((t=>{(async t=>{try{var n,a,r,i,c,s,d,u,m,p,x,g;const h=await(0,v.ut)({doBookingId:t._id}),y={"Sl No":e.length+1,"Registration Number":(null===(n=h.truckBookingId)||void 0===n||null===(a=n.truck)||void 0===a?void 0:a.registrationNumber)||"N/A",Company:(null===(r=t.deliveryOrderId)||void 0===r||null===(i=r.companyId)||void 0===i?void 0:i.name)||"N/A","Company Phone ":(null===(c=t.deliveryOrderId)||void 0===c||null===(s=c.companyId)||void 0===s||null===(d=s.contactNumber)||void 0===d?void 0:d.toString())||"N/A","DO Number":(null===(u=t.deliveryOrderId)||void 0===u?void 0:u.doNumber)||"",Location:(null===(m=t.deliveryOrderId)||void 0===m?void 0:m.location)||"N/A","Truck Type":`${t.truckType} FT`,Status:t.status,"Allocation Date":j()(t.updatedAt).format("DD/MM/YYYY HH:mm"),"Truck Company":(null===h||void 0===h||null===(p=h.truckBookingId)||void 0===p||null===(x=p.truck)||void 0===x||null===(g=x.companyId)||void 0===g?void 0:g.name)||"N/A"};if(e.push(y),e.length===o.length){const t=f.P6.book_new(),o=f.P6.json_to_sheet(e);f.P6.book_append_sheet(t,o,"Bookings");const n=(0,f.cW)(t,{bookType:"xlsx",type:"array"}),a=`Allocated_Bookings_${l.format("DD-MM-YYYY")}.xlsx`,r=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(r),c=document.createElement("a");c.href=i,c.download=a,c.click(),window.URL.revokeObjectURL(i)}}catch(Z){var y,k;console.log(Z),h.Am.error((null===(y=Z.response)||void 0===y||null===(k=y.data)||void 0===k?void 0:k.message)||"Failed to fetch allocation details")}})(t)}))},sx:{float:"right"},children:"Export to Excel"})})]})}),D&&(0,k.jsx)(p.Z,{open:I,handleClose:()=>{b(!1),C(null)},itemId:D._id,itemName:D.deliveryOrderId.doNumber,onConfirm:(e,t)=>{console.log(`Cancelled item with ID: ${e} for reason: ${t}`),(0,v.IB)(e,{cancelReason:t}).then((()=>{h.Am.success("Successfully cancelled "),_()})).catch((e=>{var t,o;console.log(e),h.Am.error((null===(t=e.response)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.message)||"Failed to cancel the item")}))},formHeading:"cancel"}),(0,k.jsx)(r.Z,{data:w,header:Z,isShowSerialNo:!0,isShowAction:!0,actions:["cancel","re-allocate"],onActionChange:e=>{console.log(e),"cancel"==e.action?(console.log(e.data._id),C(e.data),b(!0)):"re-allocate"==e.action?(0,v.Tj)(e.data._id).then((()=>{h.Am.success("Successfully cancelled "),_()})).catch((e=>{var t,o;h.Am.error((null===(t=e.response)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.message)||"Failed to reallocate the item")})):C(),a(t)},refreshData:_})]})}var b=o(1113),D=o(3497);function C(e){let{buttonClick:t,partyId:o}=e;return(0,k.jsx)(D.Z,{children:(0,k.jsxs)(l.Z,{direction:"row",sx:{justifyContent:"space-between",alignItems:"center"},children:[(0,k.jsx)(b.Z,{variant:"h3",color:"secondary.main",children:"Allocated DO Bookings"}),!1]})})}function w(){const[e,t]=(0,n.useState)([]),[o,r]=(0,n.useState)(j()());let{partyId:i}=(0,a.UO)();const c=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.format("DD/MM/YYYY");try{let o={status:"allocated",date:n};e&&(o.partyId=e);const a=await(0,v.Xy)(o);t(a)}catch(a){console.log(a)}};return(0,n.useEffect)((()=>{c(i)}),[o]),(0,k.jsxs)(l.Z,{direction:"column",gap:2,children:[(0,k.jsx)(C,{partyId:i}),(0,k.jsx)(I,{selectedDate:o,setSelectedDate:r,partyId:i,data:e,updateData:c})]})}},5713:function(e,t,o){var n=o(7313),a=o(4469),l=o(3604),r=o(6467),i=o(1113),c=o(4631),s=o(4117),d=o(1095),u=o(6417);t.Z=e=>{let{open:t,handleClose:o,itemId:m,itemName:h,onConfirm:v,formHeading:p="cancel"}=e;const[f,x]=(0,n.useState)("");return(0,u.jsxs)(a.Z,{open:t,onClose:o,children:[(0,u.jsxs)(l.Z,{children:[p," Item"]}),(0,u.jsxs)(r.Z,{children:[(0,u.jsxs)(i.Z,{children:["   Are you sure you want to ",p," the order for ",(0,u.jsx)("strong",{children:h}),"?"]}),(0,u.jsx)(c.Z,{autoFocus:!0,margin:"dense",label:" Reason",type:"text",fullWidth:!0,variant:"outlined",value:f,onChange:e=>x(e.target.value)})]}),(0,u.jsxs)(s.Z,{children:[(0,u.jsx)(d.Z,{onClick:o,color:"primary",children:"back"}),(0,u.jsxs)(d.Z,{onClick:()=>{""!==f.trim()?(v(m,f),o()):alert("Please provide a reason for cancellation.")},color:"error",children:["Confirm ",p]})]})]})}},3604:function(e,t,o){var n=o(7462),a=o(3366),l=o(7313),r=o(4146),i=o(1921),c=o(1113),s=o(7592),d=o(1033),u=o(3174),m=o(3909),h=o(6417);const v=["className","id"],p=(0,s.ZP)(c.Z,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),f=l.forwardRef((function(e,t){const o=(0,d.i)({props:e,name:"MuiDialogTitle"}),{className:c,id:s}=o,f=(0,a.Z)(o,v),x=o,g=(e=>{const{classes:t}=e;return(0,i.Z)({root:["root"]},u.a,t)})(x),{titleId:y=s}=l.useContext(m.Z);return(0,h.jsx)(p,(0,n.Z)({component:"h2",className:(0,r.Z)(g.root,c),ownerState:x,ref:t,variant:"h6",id:null!=s?s:y},f))}));t.Z=f}}]);