"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[863],{7713:function(e,t,a){var r=a(421),n=a(7120);const o=(0,r.ZF)({apiKey:"AIzaSyCBwJaecXhomn4kYayf-XMwOVfBZZyvtZ8",authDomain:"container-management-e3afb.firebaseapp.com",projectId:"container-management-e3afb",storageBucket:"container-management-e3afb.appspot.com",messagingSenderId:"355036042666",appId:"1:355036042666:web:d26919044f6afc7be387d3"}),l=(0,n.cF)(o);t.Z=l},6863:function(e,t,a){a.r(t),a.d(t,{default:function(){return J}});var r=a(7313),n=a(7890),o=a(2832),l=a(8999),s=a(5266),i=a(9536),d=a(1095),c=a(4469),u=a(4117),h=a(6467),m=a(7762),p=a(3604),x=a(1550),g=a(7131),y=a(1198),j=a(4631),f=a(8444),Z=a(3208),b=a(5904),v=a(57),S=a(658),I=a.n(S),D=a(3306),k=a(4256),C=a(1405),w=a(5480),F=a(1113),A=a(5627),_=a(1322),B=a(1387),O=a(6417);function $(e){const[t,a]=r.useState(!1),[n,o]=r.useState([]),[l,s]=r.useState(null),{control:S,handleSubmit:$,reset:q,formState:{errors:M}}=(0,A.cI)({defaultValues:{type:20}}),T=new Date,W=T,E=(0,v.E)(T,30),V=new Date(W),Y=`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}-${String(V.getDate()).padStart(2,"0")}`,N=new Date(E),U=`${N.getFullYear()}-${String(N.getMonth()+3).padStart(2,"0")}-${String(N.getDate()).padStart(2,"0")}`,P=()=>{e.onClose(),q(),a(!1)};r.useEffect((()=>{(0,_.a2)({companyId:e.data}).then((e=>{console.log(e),o(e)})).catch((e=>{console.log(e),B.Am.error(e)}))}),[e.data]),r.useEffect((()=>{a(e.open)}),[e]);return(0,O.jsx)(r.Fragment,{children:(0,O.jsx)(Z._,{dateAdapter:b.y,children:(0,O.jsx)(c.Z,{fullWidth:!0,maxWidth:"sm",open:t,onClose:P,children:(0,O.jsxs)("form",{onSubmit:$((async t=>{if(!l)return void B.Am.error("Please select a date");if(!e.doId)return void B.Am.error("Delivery order Id missing");const a=I()(l).format("YYYY-MM-DD"),{type:r,rate:n,party:o}=t;console.log({party:o,availableFrom:a,type:r,doId:e.doId,companyId:e.data,rate:n});try{await(0,_.cW)({partyId:o,deliveryOrderId:e.doId,availableFrom:a,truckType:r,rate:n,companyId:e.data}),B.Am.success("Do Created Successfully, now you can allocate truck"),P()}catch(s){console.error("Failed to create DO:",s),B.Am.error("Failed to create DO")}})),children:[(0,O.jsx)(p.Z,{children:"ADD Booking"}),(0,O.jsx)(g.Z,{"aria-label":"close",onClick:P,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,O.jsx)(y.Z,{})}),(0,O.jsxs)(h.Z,{children:[(0,O.jsx)(m.Z,{children:"Upload Delivery Order"}),(0,O.jsxs)(i.Z,{noValidate:!0,component:"form",sx:{display:"flex",flexDirection:"column",m:"auto",width:"fit-content"},children:[(0,O.jsxs)(x.Z,{error:Boolean(M.driver),children:[(0,O.jsx)(D.Z,{id:"type-select-label",children:"Party"}),(0,O.jsx)(A.Qr,{name:"party",control:S,render:e=>{let{field:t}=e;return(0,O.jsxs)(k.Z,{...t,labelId:"type-select-label",id:"type-select",label:"party",value:t.value||"",onChange:e=>{t.onChange(e.target.value)},children:[(0,O.jsx)(C.Z,{value:"",children:(0,O.jsx)("em",{children:"None"})}),n.map((e=>(0,O.jsxs)(C.Z,{value:e._id,children:[e.name," Mob: ",e.contactNumber," Address: ",e.address," "]},e._id)))]})},rules:{required:"Party is required"}}),M.party&&(0,O.jsx)(w.Z,{children:M.party.message})]}),(0,O.jsx)(x.Z,{sx:{mt:2,minWidth:120},children:(0,O.jsx)(f.M,{label:"From Date",value:l,onChange:e=>s(e),minDate:I()(Y),maxDate:I()(U),renderInput:e=>(0,O.jsx)(j.Z,{...e})})}),(0,O.jsxs)(x.Z,{error:Boolean(M.type),sx:{mt:2},children:[(0,O.jsx)(D.Z,{id:"type-select-label",children:"Type"}),(0,O.jsx)(A.Qr,{name:"type",control:S,defaultValue:20,render:e=>{let{field:t}=e;return(0,O.jsxs)(k.Z,{...t,labelId:"type-select-label",id:"type-select",label:"Type",onChange:e=>t.onChange(e.target.value),children:[(0,O.jsx)(C.Z,{value:20,children:"20 FT"}),(0,O.jsx)(C.Z,{value:40,children:"40 FT"})]})},rules:{required:"Type is required"}}),M.type&&(0,O.jsx)(w.Z,{children:M.type.message})]}),(0,O.jsx)(F.Z,{variant:"h5",children:"Rate"}),(0,O.jsx)(A.Qr,{name:"rate",control:S,render:e=>{let{field:t}=e;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(j.Z,{...t,placeholder:"Enter Rate"}),M.rate&&(0,O.jsx)("span",{style:{color:"#f00"},children:M.rate.message})]})},rules:{required:"Rate is required"}})]})]}),(0,O.jsx)(u.Z,{children:(0,O.jsx)(d.Z,{variant:"contained",type:"submit",children:"ADD Booking"})})]})})})})}const q=["name","View DO","uploadDate","status"];function M(e){let{partyId:t,data:a,updateData:o}=e;const[i,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)({}),h=(0,n.s0)(),m=(0,s.h)(a,["name","link","uploadDate","status"],q),p="admin"===localStorage.getItem("role");return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)($,{open:i,onClose:()=>{d(!1),o(t),h("/doBooking")},isEdit:!0,getBookings:o,data:null===c||void 0===c?void 0:c.companyId,doId:null===c||void 0===c?void 0:c._id}),(0,O.jsx)(l.Z,{data:m,header:q,isShowSerialNo:!0,isShowAction:!1,actions:p?["addBooking","delete"]:["delete"],onActionChange:e=>{console.log(e),"delete"==e.action?(console.log(e.data._id),u(e.data),(0,_.KI)(e.data._id).then((()=>{})).catch((e=>{console.error(e),B.Am.error(e.response.data.message)}))):"addBooking"==e.action?(u(e.data),console.log(e.data),d(!0),console.log("add to booking"),console.log(e.data._id)):u(),o(t)}})]})}var T=a(2040),W=a(3497);function E(e){let{buttonClick:t}=e;const a="both"===localStorage.getItem("role")||"forwarder"===localStorage.getItem("role");return(0,O.jsx)(W.Z,{children:(0,O.jsxs)(o.Z,{direction:"row",sx:{justifyContent:"space-between",alignItems:"center"},children:[(0,O.jsx)(F.Z,{variant:"h3",color:"secondary.main",children:"Open DO Uploads"}),a&&(0,O.jsx)(d.Z,{variant:"contained",startIcon:(0,O.jsx)(T.Z,{}),sx:{backgroundColor:"secondary.main"},onClick:t,children:"Add DO"})]})})}var V=a(7713),Y=a(9176),N=a(7120),U=a(3950),P=a(8372),R=a(2549);function Q(e){const[t,a]=r.useState(!1),[n,o]=r.useState(""),[l,s]=r.useState(null),{register:i,handleSubmit:x,setValue:g,formState:{errors:y}}=(0,A.cI)({defaultValues:{}}),f=()=>{e.onClose(),s(null),o(""),a(!1)};r.useEffect((()=>{a(e.open)}),[e.open]);return(0,O.jsx)(r.Fragment,{children:(0,O.jsx)(c.Z,{fullWidth:!0,maxWidth:"sm",open:t,onClose:f,children:(0,O.jsxs)("form",{onSubmit:x((async e=>{const{file:t,name:a}=e;if(!t)return void B.Am.error("Please choose a file");const r=`${a}-${(0,R.Z)()}`;console.log(r),console.log("-------------------------------------------------------------------------------");const n=(0,N.iH)(V.Z,`/DoBookings/${r}`),o=(0,N.B0)(n,t);o.on("state_changed",(e=>{const t=Math.round(e.bytesTransferred/e.totalBytes*100);s(t),console.log(t)}),(e=>console.log(e)),(()=>{(0,N.Jt)(o.snapshot.ref).then((e=>{try{(0,_.kR)({doLink:e,name:a,uniqueName:r}).then((()=>{f()})).catch((e=>{console.log(e),B.Am.error(e.response.data.message)}))}catch(t){console.error("Failed to create DO:",t),B.Am.error("Failed to create DO")}}))}))})),children:[(0,O.jsx)(p.Z,{children:"Upload DO"}),(0,O.jsxs)(h.Z,{children:[(0,O.jsx)(m.Z,{children:"Upload Delivery Order."}),(0,O.jsx)(j.Z,{label:"Name",variant:"outlined",fullWidth:!0,margin:"normal",...i("name",{required:!0}),error:!!y.name,helperText:y.name?"Name is required":""}),(0,O.jsx)("input",{accept:"image/*,.pdf",style:{display:"none"},id:"raised-button-file",type:"file",onChange:e=>{const t=e.target.files[0];o(t?t.name:""),g("file",t)}}),(0,O.jsxs)("label",{htmlFor:"raised-button-file",children:[(0,O.jsx)(P.Z,{display:"flex",justifyContent:"center",alignItems:"center",height:150,children:(0,O.jsx)(U.Z,{style:{fontSize:100}})}),null!==l&&(0,O.jsx)(P.Z,{sx:{width:"100%"},children:(0,O.jsx)(z,{value:l})})]}),n&&(0,O.jsx)(w.Z,{children:n})]}),(0,O.jsx)(u.Z,{children:(0,O.jsx)(d.Z,{variant:"contained",type:"submit",children:"Submit"})})]})})})}function z(e){return(0,O.jsxs)(P.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(P.Z,{sx:{width:"100%",mr:1},children:(0,O.jsx)(Y.Z,{variant:"determinate",...e})}),(0,O.jsx)(P.Z,{sx:{minWidth:35},children:(0,O.jsx)(F.Z,{variant:"body2",color:"text.secondary",children:`${Math.round(e.value)}%`})})]})}function J(){const[e,t]=(0,r.useState)(!1),[a,l]=(0,r.useState)([]);let{partyId:s}=(0,n.UO)();const i=async e=>{try{let t={status:1};e&&(t.partyId=e);const a=await(0,_.S1)(t);l(a)}catch(t){console.log(t)}};return(0,r.useEffect)((()=>{i(s)}),[]),(0,O.jsxs)(o.Z,{direction:"column",gap:2,children:[(0,O.jsx)(Q,{data:s,open:e,getBookings:i,onClose:()=>{t(!1),i(s)}}),(0,O.jsx)(E,{partyId:s,buttonClick:()=>t(!0)}),(0,O.jsx)(M,{partyId:s,data:a,updateData:i})]})}}}]);